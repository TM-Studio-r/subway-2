<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØ±Ùˆ ÛŒØ§Ø± Ø®Ø· Û³</title>
	<link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">

    <style>
        :root {
            --neon-pink: #ff5c00;
            --neon-blue: #00d4ff;
            --glass: rgba(255, 255, 255, 0.1);
        }

        body {
            margin: 0;
            font-family: 'Tahoma', sans-serif;
            background: #050505 url('109.png') no-repeat center center fixed;
            background-size: cover;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 480px;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 30px;
            padding: 25px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            text-align: center;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            max-height: 320px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 20px;
        }

        /* Ø·Ø±Ø§Ø­ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ú¯Ø±Ø¯ */
        .btn-station {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            padding: 12px;
            border-radius: 50px; 
            cursor: pointer;
            transition: 0.3s;
            font-size: 0.85rem;
        }

        .btn-station:hover {
            background: var(--neon-blue);
            box-shadow: 0 0 15px var(--neon-blue);
            color: black;
        }

        .result-panel {
            background: rgba(0,0,0,0.6);
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
            border-right: 4px solid var(--neon-pink);
            text-align: right;
            line-height: 1.8;
        }

        .highlight { color: var(--neon-blue); font-weight: bold; }
        .hidden { display: none; }
        h2 { text-shadow: 0 0 10px var(--neon-blue); }
    </style>
</head>
<body>

<div class="container">
    <h2 id="title">Ù…ØªØ±Ùˆ ÛŒØ§Ø± Ø®Ø· Û³</h2>
    
    <div id="station-section" class="grid"></div>

    <div id="day-section" class="hidden">
        <button class="btn-station" style="width:100%; margin-bottom:10px" onclick="selectDay('Ø±ÙˆØ² Ø¹Ø§Ø¯ÛŒ')">Ø±ÙˆØ² Ø¹Ø§Ø¯ÛŒ (Ø´Ù†Ø¨Ù‡ ØªØ§ Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡)</button>
        <button class="btn-station" style="width:100%; margin-bottom:10px" onclick="selectDay('Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡')">Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡</button>
        <button class="btn-station" style="width:100%; margin-bottom:10px" onclick="selectDay('ØªØ¹Ø·ÛŒÙ„ Ø±Ø³Ù…ÛŒ')">ØªØ¹Ø·ÛŒÙ„ Ø±Ø³Ù…ÛŒ</button>
    </div>

    <div id="result-section" class="hidden">
        <div class="result-panel" id="result-text"></div>
        <button class="btn-station" style="width:100%; margin-top:20px; background: var(--neon-pink)" onclick="location.reload()">Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¬Ø¯ÛŒØ¯</button>
    </div>
</div>

<script>
    // Ù„ÛŒØ³Øª Ø§ÛŒØ³ØªÚ¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø· Û³ Ø·Ø¨Ù‚ Ú©Ø¯ Ù¾Ø§ÛŒØªÙˆÙ†
    const stations = {
        "Ù‚Ø§Ø¦Ù…": 1,
        "Ø´Ù‡ÛŒØ¯ Ù…Ø­Ù„Ø§ØªÛŒ": 2,
        "Ø§Ù‚Ø¯Ø³ÛŒÙ‡": 3,
        "Ù†ÙˆØ¨Ù†ÛŒØ§Ø¯": 4,
        "Ø­Ø³ÛŒÙ†â€ŒØ¢Ø¨Ø§Ø¯": 5,
        "Ù…ÛŒØ¯Ø§Ù† Ù‡Ø±ÙˆÛŒ": 6,
        "Ø´Ù‡ÛŒØ¯ Ø²ÛŒÙ†â€ŒØ§Ù„Ø¯ÛŒÙ†": 7,
        "Ø®ÙˆØ§Ø¬Ù‡ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù†ØµØ§Ø±ÛŒ": 8,
        "Ø´Ù‡ÛŒØ¯ ØµÛŒØ§Ø¯ Ø´ÛŒØ±Ø§Ø²ÛŒ": 9,
        "Ø´Ù‡ÛŒØ¯ Ù‚Ø¯ÙˆØ³ÛŒ": 10,
        "Ø³Ù‡Ø±ÙˆØ±Ø¯ÛŒ": 11,
        "Ø´Ù‡ÛŒØ¯ Ø¨Ù‡Ø´ØªÛŒ": 12,
        "Ù…ÛŒØ±Ø²Ø§ÛŒ Ø´ÛŒØ±Ø§Ø²ÛŒ": 13,
        "Ù…ÛŒØ¯Ø§Ù† Ø¬Ù‡Ø§Ø¯": 14,
        "Ù…ÛŒØ¯Ø§Ù† Ø­Ø¶Ø±Øª ÙˆÙ„ÛŒâ€ŒØ¹ØµØ±(Ø¹Ø¬)": 15,
        "ØªØ¦Ø§ØªØ± Ø´Ù‡Ø±": 16,
        "Ù…Ù†ÛŒØ±ÛŒÙ‡": 17,
        "Ù…Ù‡Ø¯ÛŒÙ‡": 18,
        "Ø±Ø§Ù‡â€ŒØ¢Ù‡Ù†": 19,
        "Ø¬ÙˆØ§Ø¯ÛŒÙ‡": 20,
        "Ø²Ù…Ø²Ù…": 21,
        "Ø´Ù‡Ø±Ú© Ø´Ø±ÛŒØ¹ØªÛŒ": 22,
        "Ø¹Ø¨Ø¯Ù„â€ŒØ¢Ø¨Ø§Ø¯": 23,
        "Ù†Ø¹Ù…Øªâ€ŒØ¢Ø¨Ø§Ø¯": 24,
        "Ø¢Ø²Ø§Ø¯Ú¯Ø§Ù†": 25
    };

    let userSelection = { mabda: null, maghsad: null, day: null };

    // Ø³Ø§Ø®Øª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
    const grid = document.getElementById('station-section');
    Object.keys(stations).forEach(name => {
        let btn = document.createElement('button');
        btn.className = 'btn-station';
        btn.innerText = name;
        btn.onclick = () => handleSelect(name);
        grid.appendChild(btn);
    });

    function handleSelect(name) {
        if (!userSelection.mabda) {
            userSelection.mabda = name;
            document.getElementById('title').innerText = "Ù…Ù‚ØµØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯";
        } else {
            userSelection.maghsad = name;
            grid.classList.add('hidden');
            document.getElementById('day-section').classList.remove('hidden');
            document.getElementById('title').innerText = "Ù†ÙˆØ¹ Ø±ÙˆØ²";
        }
    }

    async function selectDay(day) {
        userSelection.day = day;
        document.getElementById('day-section').classList.add('hidden');
        document.getElementById('title').innerText = "Ø¯Ø± Ø­Ø§Ù„ Ù…Ø­Ø§Ø³Ø¨Ù‡...";
        await startCalculation();
    }

    async function startCalculation() {
        const mIdx = stations[userSelection.mabda];
        const tIdx = stations[userSelection.maghsad];
        let folder = "";

        // Ù…Ù†Ø·Ù‚ Ø¯Ù‚ÛŒÙ‚ Ú©Ø¯ Ù¾Ø§ÛŒØªÙˆÙ† Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù¾ÙˆØ´Ù‡
        // ØªÙˆØ¬Ù‡: Ø¯Ø± Ú©Ø¯ Ù¾Ø§ÛŒØªÙˆÙ† Ù¾ÙˆØ´Ù‡ "Ù‚Ø§ÛŒÙ…" (Ø¨Ø¯ÙˆÙ† Ù‡Ù…Ø²Ù‡) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª
        if (tIdx >= mIdx) {
            if (userSelection.day === "Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡") folder = "Ù‚Ø§ÛŒÙ…_5";
            else if (userSelection.day === "ØªØ¹Ø·ÛŒÙ„ Ø±Ø³Ù…ÛŒ") folder = "Ù‚Ø§ÛŒÙ…_Ø±Ø³Ù…ÛŒ";
            else folder = "Ù‚Ø§ÛŒÙ…_Ø¹Ø§Ø¯ÛŒ";
        } else {
            if (userSelection.day === "Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡") folder = "Ø¢Ø²Ø§Ø¯Ú¯Ø§Ù†_5";
            else if (userSelection.day === "ØªØ¹Ø·ÛŒÙ„ Ø±Ø³Ù…ÛŒ") folder = "Ø¢Ø²Ø§Ø¯Ú¯Ø§Ù†_Ø±Ø³Ù…ÛŒ";
            else folder = "Ø¢Ø²Ø§Ø¯Ú¯Ø§Ù†_Ø¹Ø§Ø¯ÛŒ";
        }

        try {
            // Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
            const respMabda = await fetch(`${folder}/${mIdx}.txt`);
            const respMaghsad = await fetch(`${folder}/${tIdx}.txt`);
            
            if (!respMabda.ok || !respMaghsad.ok) throw new Error("File not found");

            const dataMabda = (await respMabda.text()).split('\n').map(Number);
            const dataMaghsad = (await respMaghsad.text()).split('\n').map(Number);

            displayResults(dataMabda, dataMaghsad);
        } catch (err) {
            // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ø§Ú¯Ø± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯Ù†Ø¯
            document.getElementById('result-text').innerHTML = `
                <span style="color:red">Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª!</span><br>
                Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ù¾ÙˆØ´Ù‡ <b>${folder}</b> Ùˆ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ txt Ø¯Ø± Ú©Ù†Ø§Ø± ÙØ§ÛŒÙ„ HTML Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ù†Ø¯.
            `;
            document.getElementById('result-section').classList.remove('hidden');
        }
    }

    function displayResults(linesM, linesX) {
        const now = new Date();
        const nowMinutes = (now.getHours() * 60) + now.getMinutes();
        let resultDiv = document.getElementById('result-text');
        let found = false;

        for (let i = 0; i < linesM.length; i++) {
            let metro = linesM[i] - nowMinutes;
            
            // Ø§Ú¯Ø± Ø²Ù…Ø§Ù† Ø­Ø±Ú©Øª Ù†Ú¯Ø°Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
            if (metro >= 0) {
                found = true;
                let sub1 = metro === 0 ? "Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ Ø±Ø³ÛŒØ¯ÛŒ! Ø¯Ø±Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯!" : `Ù‚Ø·Ø§Ø± Ø§ÙˆÙ„ Ø­Ø¯ÙˆØ¯ <span class="highlight">${metro}</span> Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¯ÛŒÚ¯Ø± Ø¨Ù‡ Ù…Ø¨Ø¯Ø§ Ù…ÛŒâ€ŒØ±Ø³Ø¯`;
                
                // ÙØ±Ù…ÙˆÙ„ Ù¾Ø§ÛŒØªÙˆÙ†: nmet - a + Ù…ØªØ±Ùˆ
                // linesX[i] (nmet) - linesM[i] (a) + metro
                let travelTime = linesX[i] - linesM[i];
                let arrive1 = `Ø²Ù…Ø§Ù† Ø§Ø­ØªÙ…Ø§Ù„ÛŒ Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ Ù…Ù‚ØµØ¯ Ø¨Ø§ Ù‚Ø·Ø§Ø± Ø§ÙˆÙ„: <span class="highlight">${travelTime + metro}</span> Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¯ÛŒÚ¯Ø±`;
                
                let sub2 = "Ø¯ÛŒØ± Ø±Ø³ÛŒØ¯ÛŒ Ù¾Ø§ÛŒØ§Ù† Ù‚Ø·Ø§Ø± Ø¯ÙˆÙ…ÛŒ Ø¯Ø±Ú©Ø§Ø± Ù†ÛŒØ³ØªğŸ™ƒ";
                let arrive2 = "";
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ù‚Ø·Ø§Ø± Ø¯ÙˆÙ…
                if (linesM[i+1]) {
                    let nextMet = linesM[i+1] - nowMinutes;
                    sub2 = `Ù‚Ø·Ø§Ø± Ø¯ÙˆÙ… Ø­Ø¯ÙˆØ¯ <span class="highlight">${nextMet}</span> Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¯ÛŒÚ¯Ø± Ø¨Ù‡ Ù…Ø¨Ø¯Ø§ Ù…ÛŒâ€ŒØ±Ø³Ø¯`;
                    
                    let travelTime2 = linesX[i+1] - linesM[i+1];
                    arrive2 = `Ø²Ù…Ø§Ù† Ø§Ø­ØªÙ…Ø§Ù„ÛŒ Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ Ù…Ù‚ØµØ¯ Ø¨Ø§ Ù‚Ø·Ø§Ø± Ø¯ÙˆÙ…: <span class="highlight">${travelTime2 + nextMet}</span> Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¯ÛŒÚ¯Ø±`;
                }

                resultDiv.innerHTML = `
                    Ø§Ø² Ø§ÛŒØ³ØªÚ¯Ø§Ù‡ <span class="highlight">${userSelection.mabda}</span> Ø¨Ù‡ <span class="highlight">${userSelection.maghsad}</span><br>
                    ------------------------------------------<br>
                    ${sub1}<br>${arrive1}<br><br>
                    ${sub2}<br>${arrive2}
                `;
                break;
            }
        }

        if (!found) {
            resultDiv.innerHTML = "Ø¯ÛŒØ± Ø±Ø³ÛŒØ¯ÛŒ Ù¾Ø§ÛŒØ§Ù† ÙØ¹Ø§Ù„ÛŒØª Ø®Ø·ğŸ™ƒ";
        }
        
        document.getElementById('result-section').classList.remove('hidden');
        document.getElementById('title').innerText = "Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø­Ø±Ú©Øª";
    }
</script>
</body>
</html>
